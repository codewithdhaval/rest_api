---
- hosts: localhost
  become: true
  tasks:
#    - name: stop if we have old docker container
#      command: docker stop simple-devops-container
#      ignore_errors: yes
#
#    - name: remove stopped docker container
#      command: docker rm simple-devops-container
#      ignore_errors: yes
#
#    - name: remove current docker image
#      command: docker rmi simple-devops-image
#      ignore_errors: yes
    #    register: result
    #    failed_when:
    #      - result.rc == 0
    #      - '"docker" not in result.stdout'

    
    - name: building python project
      command: pipenv update

    - name: creating docker image
      command: export FLASK_APP=./app.py

    - name: activate rest_api project
      command: source "$(pipenv --venv)"/bin/activate

    - name: start flask server
      command: flask run -h 0.0.0.0 --port=8080
